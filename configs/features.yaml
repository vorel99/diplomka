# Feature Configuration
# This file defines which features to include in the feature matrix and their parameters

# Municipalities reference data - used as the basis for joining all features
municipalities:
  class: MunicipalityFeature
  module: geoscore_de.data_flow.municipality
  params:
    raw_data_path: data/raw/municipalities_2022.csv

features:
  # Population demographics feature
  - name: population
    class: PopulationFeature
    module: geoscore_de.data_flow.features.population
    params:
      raw_data_path: data/raw/features/population.csv
      tform_data_path: data/tform/features/population.csv

  # Federal election 2021 results
  - name: election_2021
    class: Election21Feature
    module: geoscore_de.data_flow.features.election_21
    params:
      url: https://www.bundeswahlleiterin.de/en/dam/jcr/c2cd99e6-064e-4ebc-b634-f86b5c0e14b3/btw21_wbz.zip
      raw_data_path: data/raw/features/election_2021
      tform_data_path: data/tform/features/federal_election_21.csv
    before_transforms:
      - name: election_2021_homogeneity
        class: HomogeneityFeatureEngineering
        module: geoscore_de.data_flow.feature_engineering.homogenity
        input_columns: ["E_CDU", "E_SPD", "E_AfD", "E_FDP", "E_DIE LINKE", "E_GRÜNE", "E_CSU"]
        output_column: homogeneity
        params:
          weight_column: eligible_voters

  # Federal election 2025 results
  - name: election_2025
    class: Election25Feature
    module: geoscore_de.data_flow.features.election_25
    params:
      url: https://www.bundeswahlleiterin.de/en/dam/jcr/e79a7bd3-0607-4e87-9752-8e601e299e00/btw25_wbz.zip
      raw_data_path: data/raw/features/election_2025
      tform_data_path: data/tform/features/election_25.csv
    before_transforms:
      - name: election_2025_homogeneity
        class: HomogeneityFeatureEngineering
        module: geoscore_de.data_flow.feature_engineering.homogenity
        input_columns: [
          "SPD - Erststimmen","CDU - Erststimmen","GRÜNE - Erststimmen","FDP - Erststimmen","AfD - Erststimmen","CSU - Erststimmen","Die Linke - Erststimmen"
        ]
        output_column: homogeneity
        params:
          weight_column: eligible_voters

  - name: unemployment
    class: UnemploymentFeature
    module: geoscore_de.data_flow.features.unemployment
    params:
      raw_data_path: data/raw/features/unemployment.csv
      tform_data_path: data/tform/features/unemployment.csv

# Matrix building configuration
matrix:
  # Key column to join all features on (municipality code)
  join_key: AGS
  
  # Whether to save the feature matrix to a file
  save_output: true
  
  # Path to save the final feature matrix
  output_path: data/final/feature_matrix.csv
  
  # Handle missing values: 'drop', 'fill', or null for no action
  missing_values: null
  
  # If missing_values is 'fill', specify the fill value (e.g., 0, 'mean', 'median')
  fill_value: 0
